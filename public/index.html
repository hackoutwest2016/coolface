<!doctype html>
<html>
<head>
  <title>Jukebox!</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
  <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Search for an Artist</h1>

    <form id="search-form">
      <div class="input-group">
      <input type="text" id="query" class="form-control" placeholder="Search for artist...">
      <span class="input-group-btn">
        <button  type="submit" id="search" class="btn btn-default" value="Search">Search</button>
      </span>
    </div>

    </form>
    <div >
      <ul id="results" class="list-group">
      </ul>
    </div>
  </div>

  <script>
  var resultsPlaceholder = document.getElementById('results');

  var fetchTracks = function (albumId, callback) {
    $.ajax({
      url: 'https://api.spotify.com/v1/albums/' + albumId,
      success: function (response) {
        callback(response);
      }
    });
  };

  var searchArtist = function (query) {
    $.ajax({
      url: 'https://api.spotify.com/v1/search',
      data: {
        q: query,
        type: 'artist',
        limit: 1
      },
      success: function (response) {
        var id = response.artists.items[0].id,
        name = response.artists.items[0].name;

        resultsPlaceholder.innerHTML = '<h4>' + name + ' (ID: ' +  id + ') top 10 tracks</h4>' ;
        getTopTracks(id);
      }
    });
  };

  var getTopTracks = function (artistId) {
    $.ajax({
      url: 'https://api.spotify.com/v1/artists/' + artistId + '/top-tracks?country=SE',
      success: function (response) {

        for (var i = 0; i < response.tracks.length; i++) {
          //console.log(response.tracks[i]);
          var track = response.tracks[i].name
          trackId = response.tracks[i].id;
          resultsPlaceholder.innerHTML += '<li class="list-group-item">' + track + ': ' + trackId +
                                          ' <button id=' + trackId + ' class="btn btn-default btn-vote">Add to que</button>';

        }

        for (var i = 0; i < voteButtons.length; i++) {
            voteButtons[i].addEventListener('click', voteTrack, false);
        }

      }
    });
  };

  document.getElementById('search-form').addEventListener('submit', function (e) {
    e.preventDefault();
    searchArtist(document.getElementById('query').value);
  }, false);

  var voteButtons = document.getElementsByClassName("btn-vote");

  var voteTrack = function(id) {
    console.log("Vote for track id: " + this.id);
    this.classList += ' disabled';
  };

  </script>
</body>
</html>
